# Twitter-pywebview

Single-source repository for the app lives in `Gugusay1.0/`.

## Repository Layout

- `Gugusay1.0/`: only maintained source code
- `version_template.json`: GitHub Release manifest v2 template
- build scripts/spec files in repo root (for packaging workflows)

Portable folders and historical duplicate trees were removed from source control.

## Update Architecture

The update flow is now:

1. Frontend calls `GET /api/update/check` (token-protected).
2. Backend `update_manager.py` pulls manifest from GitHub Releases (`version.json`).
3. Assets are downloaded to staging and verified by SHA256 (+ optional Ed25519 signature).
4. Backend starts external updater mode:
   - `sys.executable --run-updater <task_json> <parent_pid>`
5. `updater_client.py` waits parent exit, replaces DB/media, writes new version, restarts app.

## Update Config API

- `GET /api/update/config` (local-only): returns `owner`, `repo`, `channel`, `request_token`
- `PUT /api/update/config` (token required): accepts:
  - `owner`
  - `repo`
  - `channel`

`channel` can be `latest` or a release tag.

## Manifest v2

See `version_template.json`:

- `manifest_version`
- `version`
- `published_at`
- `min_app_version`
- `notes`
- `assets[]`
  - `kind`: `database` / `media_pack` / `media_file`
  - `name`
  - `url` (HTTPS only)
  - `sha256`
  - `signature` (Ed25519 base64, optional but recommended)

## Security Hardening

- Update source forced to HTTPS.
- Asset SHA256 verification on download.
- Optional Ed25519 signature verification hook in `update_manager.py`.
- Update endpoints require local-origin + per-session `X-Update-Token`.
- Static file serving now checks path stays inside app root.
- Progress API normalized to `/api/progress` (`/api/reading-progress` kept as alias in backend).

## Build Notes

- Run from `Gugusay1.0/` source.
- `main.py` supports updater mode via `--run-updater`.
- Portable output should be generated by build scripts, not committed as source.
